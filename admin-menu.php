<?php

 $_lang_codes = array(
    'Afar'    => 'aa',
    'Abkhazian'    => 'ab',
    'Avestan'    => 'ae',
    'Afrikaans'    => 'af',
    'Akan'    => 'ak',
    'Amharic'    => 'am',
    'Arabic'    => 'ar',
    'Assamese'    => 'as',
    'Avar'    => 'av',
    'Aymara'    => 'ay',
    'Azerbaijani'    => 'az',
    'Bashkir'    => 'ba',
    'Belarusian'    => 'be',
    'Bulgarian'    => 'bg',
    'Bihari'    => 'bh',
    'Bislama'    => 'bi',
    'Bambara'    => 'bm',
    'Bengali'    => 'bn',
    'Tibetan'    => 'bo',
    'Breton'    => 'br',
    'Bosnian'    => 'bs',
    'Catalan'    => 'ca',
    'Chechen'    => 'ce',
    'Chamorro'    => 'ch',
    'Corsican'    => 'co',
    'Cree'    => 'cr',
    'Czech'    => 'cs',
    'Old Slavonic'    => 'cu',
    'Chuvash'    => 'cv',
    'Welsh'    => 'cy',
    'Danish'    => 'da',
    'German'    => 'de',
    'Maldivian'    => 'dv',
    'Bhutani'    => 'dz',
    'Ewe'    => 'ee',
    'Greek'    => 'el',
    'English'    => 'en',
    'Esperanto'    => 'eo',
    'Spanish'    => 'es',
    'Estonian'    => 'et',
    'Basque'    => 'eu',
    'Persian'    => 'fa',
    'Fulah'    => 'ff',
    'Finnish'    => 'fi',
    'Fiji'    => 'fj',
    'Faeroese'    => 'fo',
    'French'    => 'fr',
    'Frisian'    => 'fy',
    'Irish'    => 'ga',
    'Scots Gaelic'    => 'gd',
    'Galician'    => 'gl',
    'Guarani'    => 'gn',
    'Gujarati'    => 'gu',
    'Manx'    => 'gv',
    'Hausa'    => 'ha',
    'Hebrew'    => 'he',
    'Hindi'    => 'hi',
    'Hiri Motu'    => 'ho',
    'Croatian'    => 'hr',
    'Hungarian'    => 'hu',
    'Armenian'    => 'hy',
    'Herero'    => 'hz',
    'Interlingua'    => 'ia',
    'Indonesian'    => 'id',
    'Interlingue'    => 'ie',
    'Igbo'    => 'ig',
    'Inupiak'    => 'ik',
    'Icelandic'    => 'is',
    'Italian'    => 'it',
    'Inuktitut'    => 'iu',
    'Japanese'    => 'ja',
    'Javanese'    => 'jv',
    'Georgian'    => 'ka',
    'Kongo'    => 'kg',
    'Kikuyu'    => 'ki',
    'Kwanyama'    => 'kj',
    'Kazakh'    => 'kk',
    'Greenlandic'    => 'kl',
    'Cambodian'    => 'km',
    'Kannada'    => 'kn',
    'Korean'    => 'ko',
    'Kanuri'    => 'kr',
    'Kashmiri'    => 'ks',
    'Kurdish'    => 'ku',
    'Komi'    => 'kv',
    'Cornish'    => 'kw',
    'Kirghiz'    => 'ky',
    'Latin'    => 'la',
    'Luxembourgish'    => 'lb',
    'Luganda'    => 'lg',
    'Lingala'    => 'ln',
    'Laothian'    => 'lo',
    'Lithuanian'    => 'lt',
    'Latvian'    => 'lv',
    'Malagasy'    => 'mg',
    'Marshallese'    => 'mh',
    'Maori'    => 'mi',
    'Macedonian'    => 'mk',
    'Malayalam'    => 'ml',
    'Mongolian'    => 'mn',
    'Moldavian'    => 'mo',
    'Marathi'    => 'mr',
    'Malay'    => 'ms',
    'Maltese'    => 'mt',
    'Burmese'    => 'my',
    'Nauru'    => 'na',
    'North Ndebele'    => 'nd',
    'Nepali'    => 'ne',
    'Ndonga'    => 'ng',
    'Dutch'    => 'nl',            
    'Norwegian Bokmål'    => 'nb',
    'Norwegian Nynorsk'    => 'nn',
    'South Ndebele'    => 'nr',
    'Navajo'    => 'nv',
    'Chichewa'    => 'ny',
    'Occitan'    => 'oc',
    'Oromo'    => 'om',
    'Oriya'    => 'or',
    'Ossetian'    => 'os',
    'Punjabi'    => 'pa',
    'Pali'    => 'pi',
    'Polish'    => 'pl',
    'Pashto'    => 'ps',
    'Portuguese, Portugal'    => 'pt-pt',
    'Portuguese, Brazil'    => 'pt-br',
    'Quechua'    => 'qu',
    'Rhaeto-Romance'    => 'rm',
    'Kirundi'    => 'rn',
    'Romanian'    => 'ro',
    'Russian'    => 'ru',
    'Kinyarwanda'    => 'rw',
    'Sanskrit'    => 'sa',
    'Sardinian'    => 'sc',
    'Sindhi'    => 'sd',
    'Northern Sami'    => 'se',
    'Sango'    => 'sg',
    'Serbo-Croatian'    => 'sh',
    'Singhalese'    => 'si',
    'Slovak'    => 'sk',
    'Slovenian'    => 'sl',
    'Samoan'    => 'sm',
    'Shona'    => 'sn',
    'Somali'    => 'so',
    'Albanian'    => 'sq',
    'Serbian'    => 'sr',
    'Siswati'    => 'ss',
    'Sesotho'    => 'st',
    'Sudanese'    => 'su',
    'Swedish'    => 'sv',
    'Swahili'    => 'sw',
    'Tamil'    => 'ta',
    'Telugu'    => 'te',
    'Tajik'    => 'tg',
    'Thai'    => 'th',
    'Tigrinya'    => 'ti',
    'Turkmen'    => 'tk',
    'Tagalog'    => 'tl',
    'Setswana'    => 'tn',
    'Tonga'    => 'to',
    'Turkish'    => 'tr',
    'Tsonga'    => 'ts',
    'Tatar'    => 'tt',
    'Twi'    => 'tw',
    'Tahitian'    => 'ty',
    'Uighur'    => 'ug',
    'Ukrainian'    => 'uk',
    'Urdu'    => 'ur',
    'Uzbek'    => 'uz',
    'Venda'    => 've',
    'Vietnamese'    => 'vi',
    'Wolof'    => 'wo',
    'Xhosa'    => 'xh',
    'Yiddish'    => 'yi',
    'Yoruba'    => 'yo',
    'Zhuang'    => 'za',
    'Chinese' => 'zh',
    'Chinese (Simplified)'    => 'zh-hans',
    'Chinese (Traditional)'    => 'zh-hant',
    'Zulu'    => 'zu',
    'Slavic'    => 'sla'
); 

$lang_codes = array_flip($_lang_codes);


add_action('admin_menu', 'home_create_menu');


function admin_init() {
	$path = WP_PLUGIN_URL .'/accueil';//dirname(__FILE__);//get_bloginfo('template_url');
	wp_enqueue_script( 'accueil_script', $path.'/js/ui_controller.js', array('jquery'), 0.1, TRUE );
    $myStyleUrl = $path. '/css/style_home.css';
	wp_register_style('myStyleSheets', $myStyleUrl);
    wp_enqueue_style( 'myStyleSheets');
	if(function_exists("add_thickbox")){
        add_thickbox();
    }else{
        wp_enqueue_script('thickbox');
    }
    wp_enqueue_script('media-upload');
}

 
		

function home_create_menu() {

	//create new top-level menu
	$path =  WP_PLUGIN_URL .'/accueil';//dirname(__FILE__); //get_bloginfo('template_url');
	
	add_menu_page( __('Paramètre accueil'),  __('Accueil'), 'edit_pages', __FILE__, 'home_settings_page', $path.'/accueil.png');

	//call register settings function

    if (isset($_GET['page']) && $_GET['page'] == 'accueil/admin-menu.php') {
        add_action( 'admin_init', 'register_mysettings' );
    }
}

function register_mysettings() {  
        //register our settings  
  
      if(function_exists("icl_get_languages")){
        $languages = icl_get_languages('skip_missing=0&orderby=code');
        foreach($languages as $l){
          $sel_lang[$i] = $l['language_code'];
          $i++;
        }
      }else if(function_exists("qtrans_init")){
        $sel_lang = qtrans_getSortedLanguages();
      }
      else{
        $sel_lang = Array(0 => get_bloginfo('language'));
      }
      if(!empty($sel_lang)){ 
		  foreach($sel_lang as $l){
            $home_content = 'home_content_'.$l;
            //echo $home_content."," ;
            register_setting( 'home-settings-group', "home_content_fr" );  
            //register_setting( 'home-settings-group', $home_content );  
	  }
	} 
}  

function home_settings_page() {   
  if(function_exists("icl_get_languages")){ 
    $languages = icl_get_languages('skip_missing=0&orderby=code');
    foreach($languages as $l){
      $sel_lang[$i] = $l['language_code'];
      $i++;
    }
  }
  else if(function_exists("qtrans_init")){
    $sel_lang = qtrans_getSortedLanguages();
  }else{
    $sel_lang = Array(0 => get_bloginfo('language'));
  }
?>

<div class="wrap">
<h2><?php _e("Options de l'accueil");?></h2>
<p> <?php _e("Cette page vous permet d'ajouter des images et des liens à la page d'accueil du site");?> <?php echo get_bloginfo('name'); ?></p>


<form id="content_home">
	<h3>Options du slide </h3>
	  <?php 
        if(!empty($sel_lang)){ 
          $path = WP_PLUGIN_URL .'/accueil';
          global $lang_codes;
		  foreach($sel_lang as $l){?>
    <h3><img src="../wp-content/plugins/accueil/images/<?php echo $l ?>.png"/> Page d'accueil en <?php echo $lang_codes[$l];?> :</h3>
    <p>Pour ajouter une diapositive en <?php echo $l['native_name'];?> cliquez sur <i>Ajouter un slide <?php echo $lang_codes[$l];?></i></p>
        <span name="button_<?php echo $l;?>" code_pays="<?php echo $l;?>" class="add button-primary"><?php _e("Ajouter un slide").'" "'.$l['native_name']; ?> </span>
		<br>
	<?php
	$home_content = 'home_content_'.$l;
   	$frSlides = json_decode(get_option($home_content));
   	$cpt = 0;
   	if(count($frSlides)>2){
   		foreach ($frSlides as $input) {
		   	if($cpt%3 == 0)
	 			{echo'<table class="table_'.$l.'" id="form-table-'.$l.'-'. $cpt/3 .'">';}
			 	//if (strpos($input->{'name'},'title')) {
			echo'<tr valign="top">'.
					'<th scope="row">'.$input->{'name'}.'</th>'.
					'<td><textarea name="'.$input->{'name'}.'" id="'.$input->{'name'}.'">'.$input->{'value'}.'</textarea></td>'.
				'</tr>';

		$cpt++;
		   	if($cpt%3 == 0){
						$val = $cpt/3 - 1;
						echo '<tr valign="top">
						<th scope="row">Upload Image</th>
						<td><input class="upload_image_button" lien="'.$l.'_Image-'.$val .'" name="button'.$val .'" type="button" value="Upload Image" />
						<br /><label>'; echo _e('Entrer un URL ou charger une image en appyant sur le bouton');
						echo '</label></td>
						</tr>';
   				if($cpt/3 == 1)
   					echo '<tr><th></th><td><span style="background-color:#FF4D1A;float:right;visibility:hidden;"class="removeTable_home button-primary" name="form-table-'.$l.'-'. $cpt/3 .'">Supprimer</span></td></tr>';
   				else
					echo '<tr><th></th><td><span style="background-color:#FF4D1A;float:right;"class="removeTable_home button-primary" name="form-table-'.$l.'-'. (($cpt/3)-1) .'">Supprimer</span></td></tr>';
				
				echo '</table>';
			}
		}
	}
	else{
?>
    <!--<table class="table_<?php echo $l;?>" id="form-table-<?php echo $l;?>-0">
        <tr valign="top">
        <th scope="row"><?php _e("Titre");?> :</th>
        <td><textarea name="<?php echo $l;?>_Titre-0" id="<?php echo $l;?>_Titre-0"></textarea></td>
        </tr>

        <tr valign="top">
        <th scope="row"><?php _e("Image")?> :</th>
        <td><textarea style="display:none;"name="<?php echo $l;?>_Image-0" id="<?php echo $l;?>_Image-0"></textarea> <a href="/wp-admin/media-upload.php?post_id=1&amp;TB_iframe=1" class="thickbox add_media" id="content-add_media-0" title="Add Media" onclick="return false;"><?php _e("Upload/Insert");?> <img src="http://sandbox-wp.dev/wp-admin/images/media-button.png?ver=20111005" width="15" height="15"></a></td>
        </tr>

        <tr valign="top">
        <th scope="row"><?php _e("Légende");?> :</th>
        <td><textarea name="<?php echo $l;?>_Legend-0" id="<?php echo $l;?>_Legend-0"></textarea></td>
        </tr>

        <tr valign="top">
        <th scope="row"><?php _e("Liens vers");?> :</th>
        <td><textarea name="<?php echo $l;?>_Url-0" id="<?php echo $l;?>_Url-0"></textarea></td>
        </tr>

    </table>-->
<?php    
}
}
}
?>
	
</form>


<form id="home_handler">
    <?php settings_fields('home-settings-group'); ?>
    <?php //do_settings_fields( 'home-settings-group' );?>

    


	<?php if(!empty($sel_lang)){ 
		foreach($sel_lang as $l){	
	?>
        <input id="home_content_fr" name="home_content_fr" type="text" style="visibility:hidden"/>
		<!--<input id="home_content_<?php echo $l;?>" name="home_content_<?php echo $l;?>" type="text" style="visibility:hidden"/>-->
	<?php    
		}
	}
	?>
		<?php if(!empty($sel_lang)){ 
		foreach($sel_lang as $l){	
	?>
		<div id="code" code_pays="<?php echo $l;?>"></div>
	<?php    
		}
	}
	?>
    <p class="submit">
    <span id="save_home" style="background-color:#D3FF82;" class="button-primary"><?php _e('Sauvegarder') ?> </span>
    </p>
</form>
</div>

<?php
} ?>