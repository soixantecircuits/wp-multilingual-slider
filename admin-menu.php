<?php

 $_lang_codes = array(
    'Afar'    => 'aa',
    'Abkhazian'    => 'ab',
    'Avestan'    => 'ae',
    'Afrikaans'    => 'af',
    'Akan'    => 'ak',
    'Amharic'    => 'am',
    'Arabic'    => 'ar',
    'Assamese'    => 'as',
    'Avar'    => 'av',
    'Aymara'    => 'ay',
    'Azerbaijani'    => 'az',
    'Bashkir'    => 'ba',
    'Belarusian'    => 'be',
    'Bulgarian'    => 'bg',
    'Bihari'    => 'bh',
    'Bislama'    => 'bi',
    'Bambara'    => 'bm',
    'Bengali'    => 'bn',
    'Tibetan'    => 'bo',
    'Breton'    => 'br',
    'Bosnian'    => 'bs',
    'Catalan'    => 'ca',
    'Chechen'    => 'ce',
    'Chamorro'    => 'ch',
    'Corsican'    => 'co',
    'Cree'    => 'cr',
    'Czech'    => 'cs',
    'Old Slavonic'    => 'cu',
    'Chuvash'    => 'cv',
    'Welsh'    => 'cy',
    'Danish'    => 'da',
    'German'    => 'de',
    'Maldivian'    => 'dv',
    'Bhutani'    => 'dz',
    'Ewe'    => 'ee',
    'Greek'    => 'el',
    'English'    => 'en',
    'Esperanto'    => 'eo',
    'Spanish'    => 'es',
    'Estonian'    => 'et',
    'Basque'    => 'eu',
    'Persian'    => 'fa',
    'Fulah'    => 'ff',
    'Finnish'    => 'fi',
    'Fiji'    => 'fj',
    'Faeroese'    => 'fo',
    'French'    => 'fr',
    'Frisian'    => 'fy',
    'Irish'    => 'ga',
    'Scots Gaelic'    => 'gd',
    'Galician'    => 'gl',
    'Guarani'    => 'gn',
    'Gujarati'    => 'gu',
    'Manx'    => 'gv',
    'Hausa'    => 'ha',
    'Hebrew'    => 'he',
    'Hindi'    => 'hi',
    'Hiri Motu'    => 'ho',
    'Croatian'    => 'hr',
    'Hungarian'    => 'hu',
    'Armenian'    => 'hy',
    'Herero'    => 'hz',
    'Interlingua'    => 'ia',
    'Indonesian'    => 'id',
    'Interlingue'    => 'ie',
    'Igbo'    => 'ig',
    'Inupiak'    => 'ik',
    'Icelandic'    => 'is',
    'Italian'    => 'it',
    'Inuktitut'    => 'iu',
    'Japanese'    => 'ja',
    'Javanese'    => 'jv',
    'Georgian'    => 'ka',
    'Kongo'    => 'kg',
    'Kikuyu'    => 'ki',
    'Kwanyama'    => 'kj',
    'Kazakh'    => 'kk',
    'Greenlandic'    => 'kl',
    'Cambodian'    => 'km',
    'Kannada'    => 'kn',
    'Korean'    => 'ko',
    'Kanuri'    => 'kr',
    'Kashmiri'    => 'ks',
    'Kurdish'    => 'ku',
    'Komi'    => 'kv',
    'Cornish'    => 'kw',
    'Kirghiz'    => 'ky',
    'Latin'    => 'la',
    'Luxembourgish'    => 'lb',
    'Luganda'    => 'lg',
    'Lingala'    => 'ln',
    'Laothian'    => 'lo',
    'Lithuanian'    => 'lt',
    'Latvian'    => 'lv',
    'Malagasy'    => 'mg',
    'Marshallese'    => 'mh',
    'Maori'    => 'mi',
    'Macedonian'    => 'mk',
    'Malayalam'    => 'ml',
    'Mongolian'    => 'mn',
    'Moldavian'    => 'mo',
    'Marathi'    => 'mr',
    'Malay'    => 'ms',
    'Maltese'    => 'mt',
    'Burmese'    => 'my',
    'Nauru'    => 'na',
    'North Ndebele'    => 'nd',
    'Nepali'    => 'ne',
    'Ndonga'    => 'ng',
    'Dutch'    => 'nl',            
    'Norwegian Bokmål'    => 'nb',
    'Norwegian Nynorsk'    => 'nn',
    'South Ndebele'    => 'nr',
    'Navajo'    => 'nv',
    'Chichewa'    => 'ny',
    'Occitan'    => 'oc',
    'Oromo'    => 'om',
    'Oriya'    => 'or',
    'Ossetian'    => 'os',
    'Punjabi'    => 'pa',
    'Pali'    => 'pi',
    'Polish'    => 'pl',
    'Pashto'    => 'ps',
    'Portuguese, Portugal'    => 'pt-pt',
    'Portuguese, Brazil'    => 'pt-br',
    'Quechua'    => 'qu',
    'Rhaeto-Romance'    => 'rm',
    'Kirundi'    => 'rn',
    'Romanian'    => 'ro',
    'Russian'    => 'ru',
    'Kinyarwanda'    => 'rw',
    'Sanskrit'    => 'sa',
    'Sardinian'    => 'sc',
    'Sindhi'    => 'sd',
    'Northern Sami'    => 'se',
    'Sango'    => 'sg',
    'Serbo-Croatian'    => 'sh',
    'Singhalese'    => 'si',
    'Slovak'    => 'sk',
    'Slovenian'    => 'sl',
    'Samoan'    => 'sm',
    'Shona'    => 'sn',
    'Somali'    => 'so',
    'Albanian'    => 'sq',
    'Serbian'    => 'sr',
    'Siswati'    => 'ss',
    'Sesotho'    => 'st',
    'Sudanese'    => 'su',
    'Swedish'    => 'sv',
    'Swahili'    => 'sw',
    'Tamil'    => 'ta',
    'Telugu'    => 'te',
    'Tajik'    => 'tg',
    'Thai'    => 'th',
    'Tigrinya'    => 'ti',
    'Turkmen'    => 'tk',
    'Tagalog'    => 'tl',
    'Setswana'    => 'tn',
    'Tonga'    => 'to',
    'Turkish'    => 'tr',
    'Tsonga'    => 'ts',
    'Tatar'    => 'tt',
    'Twi'    => 'tw',
    'Tahitian'    => 'ty',
    'Uighur'    => 'ug',
    'Ukrainian'    => 'uk',
    'Urdu'    => 'ur',
    'Uzbek'    => 'uz',
    'Venda'    => 've',
    'Vietnamese'    => 'vi',
    'Wolof'    => 'wo',
    'Xhosa'    => 'xh',
    'Yiddish'    => 'yi',
    'Yoruba'    => 'yo',
    'Zhuang'    => 'za',
    'Chinese' => 'zh',
    'Chinese (Simplified)'    => 'zh-hans',
    'Chinese (Traditional)'    => 'zh-hant',
    'Zulu'    => 'zu',
    'Slavic'    => 'sla'
); 

$lang_codes = array_flip($_lang_codes);

function my_admin_init() {
	$path = WP_PLUGIN_URL .'/wp-multilingual-slider';//dirname(__FILE__);//get_bloginfo('template_url');
	wp_enqueue_script( 'accueil_script', $path.'/js/ui_controller.js', array('jquery'), 0.1, TRUE );
   $myStyleUrl = $path. '/css/style_home.css';
	wp_register_style('myStyleSheets', $myStyleUrl);
   wp_enqueue_style( 'myStyleSheets');
	wp_register_script( 'jquery_ui', 'https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.18/jquery-ui.min.js' );
	wp_enqueue_script( 'jquery_ui' );
	
	if(function_exists("add_thickbox")){
		add_thickbox();
   }else{
		wp_enqueue_script('thickbox');
   }
   wp_enqueue_script('media-upload');
	register_mysettings();
}

function register_mysettings() {  
	//register our settings  
	register_setting( 'home-settings-group', 'home_content');  

	if(function_exists("icl_get_languages")){
		$languages = icl_get_languages('skip_missing=0&orderby=code');
		foreach($languages as $l){
			$sel_lang[$i] = $l['language_code'];
			$i++;
		}
	}else if(function_exists("qtrans_init")){
		$sel_lang = qtrans_getSortedLanguages();
	}
	else{
		$sel_lang = Array(0 => get_bloginfo('language'));
	}
}

function home_create_menu() {

	//create new top-level menu
	$path =  WP_PLUGIN_URL .'/wp-multilingual-slider';//dirname(__FILE__); //get_bloginfo('template_url');
	
	add_menu_page( __('Paramètre accueil'),  __('Accueil'), 'edit_pages', __FILE__, 'home_settings_page', $path.'/accueil.png');

}

function home_settings_page() {   
  if(function_exists("icl_get_languages")){ 
    $languages = icl_get_languages('skip_missing=0&orderby=code');
    foreach($languages as $l){
      $sel_lang[$i] = $l['language_code'];
      $i++;
    }
  }
  else if(function_exists("qtrans_init")){
    $sel_lang = qtrans_getSortedLanguages();
  }else{
    $sel_lang = Array(0 => get_bloginfo('language'));
  }
?>

<div class="wrap">
<div id="tabs">
    <ul class="tab_select">
      <li><a href="#tabs-slides">Contenus</a></li>
      <li><a href="#tabs-options">Options</a></li>
    </ul>

<div id="tabs-options">
    <h2><?php _e("Options de l'accueil");?></h2>
</div>

<div id="tabs-slides">
    <div class="wrap">
    <h2><?php _e("Contenu des slides");?> </h2>
    <p> <?php _e("Cette page vous permet d'ajouter des images et des liens à la page d'accueil du site");?>&nbsp;<?php echo get_bloginfo('name'); ?></p>


    
<?php 
if(!empty($sel_lang)){ 
    $path = WP_PLUGIN_URL .'/wp-multilingual-slider';
    global $lang_codes;
    $home_content = 'home_content';
    $allSlides = get_option($home_content);?>
    <div id="columnizer">
<?php
    foreach($sel_lang as $l) {
?>

        <div id="column-<?php echo $l; ?>" class="column column-<?php echo count($sel_lang); ?>">
        <form id="content_home-<?php echo $l; ?>" class="content_home">
        <h3><img src="../wp-content/plugins/wp-multilingual-slider/images/<?php echo $l ?>.png"/> Page d'accueil en <?php echo $lang_codes[$l];?> :</h3>
        <p><?php _e('Pour ajouter une diapositive en', 'wp-multilingual-slider'); echo " " . $l;?> <?php _e('cliquez sur <i>Ajouter un slide', 'wp-multilingual-slider');?> <?php echo $lang_codes[$l];?></i></p>
        <button type="button" name="button_<?php echo $l;?>" code_pays="<?php echo $l;?>" id="add_slide-<?php echo $l; ?>" class="add button-primary">
            <?php echo (__("Ajouter un slide", 'wp-multilingual-slider')." ".$l); ?>
        </button>
        <ul id="slide_list-<?php echo $l; ?>" class="slide_list">
        <span id="sentinel-<?php echo $l; ?>"></span>
<?php

        $slides = json_decode($allSlides[$l]);
        $cpt = 0;
        for ($i = 0; $i < count($slides)/5; $i++) { ?>
            <table id="_" class="table_content table-<?php echo $l; ?>">
             <tr align="left">
                <th scope="row">Titre :</th>
                <td>
                  <input id="_title_" class="title-<?php echo $l; ?>" name="_title_" value="<?php echo $slides[$i*5]->{'value'}; ?>" />
                </td>
             </tr>

             <tr align="left">
                <th scope="row">Sous-titre :</th>
                <td>
                  <input id="_sub_" class="sub-<?php echo $l; ?>" name="_sub_" value="<?php echo $slides[$i*5+1]->{'value'}; ?>" />
                </td>
             </tr>

             <tr align="left">
                <th scope="row">Légende :</th>
                <td>
                  <input id="_legend_" class="legend-<?php echo $l; ?>" name="_legend_" value="<?php echo $slides[$i*5+2]->{'value'}; ?>" />
                </td>
             </tr>

             <tr align="left">
                <th scope="row">Url :</th>
                <td>
                  <input id="_url_" class="url-<?php echo $l; ?>" name="_url_" value="<?php echo $slides[$i*5+3]->{'value'}; ?>" />
                </td>
             </tr>

             <tr align="left">
                <th scope="row">Image :</th>
                <td>
                  <a id="_content-add_media_" class="thickbox add_media" onclick="return false;"
                        title="Add Media" href="media-upload.php?post_id=1&TB_iframe=1">Upload/Insert</a>
                  <input id="_image_" class="image-<?php echo $l; ?>" name="_image_" value="<?php echo $slides[$i*5+4]->{'value'}; ?>" type="hidden" />
                  <?php if ($slides[$i*5+4]->{'value'} != '') { ?>
                    <p class="img_home">
                        <img title="img-<?php echo $i; ?>" src="<?php echo $slides[$i*5+4]->{'value'}; ?>" />
                    </p>
                  <?php } ?>
                </td>
             </tr>

             <tr>
                <th>
                  <a id="_up_" class="up-<?php echo $l; ?>" onclick="return false;" href="#">Monter</a>
                    /
                  <a id="_down_" class="down-<?php echo $l; ?>" onclick="return false;" href="#">Descendre</a>
                </th>
                <td>
                  <button id="_remove_table_" class="remove_table-<?php echo $l; ?> button-primary" name="_form-table_" 
                        style="border-color:#FF4D1A;background:#FF4D1A;float:right;" type="button">Supprimer</button>
                </td>
             </tr>
        </table>
        <?php
        }
    ?></ul></form></div><?php
    }
}
?>
</div>

<form id="home_handler" method="post" action="options.php">
	<?php settings_fields('home-settings-group'); ?>

	<?php 
	if(!empty($sel_lang)) {
		foreach($sel_lang as $l) { ?>
			<input type="hidden" id="home_content[<?php echo $l;?>]" name="home_content[<?php echo $l;?>]" type="text" />
			<div id="code" code_pays="<?php echo $l;?>"></div>
		<?php
		}
	}
	?>

	<p class="submit">
		<button type="button" id="save_home" style="background:#33AA22;color:#FFF" class="button-primary"><?php _e('Sauvegarder') ?></button>
	</p>
</form>
</div>
</div>
</div>
</div>

<?php
} ?>
